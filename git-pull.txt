#!/bin/bash

DIR=/.
LOG=/tmp/_git-pull.log-$(date "+%s")

PRE_PULL=/pre-pull
POST_PULL=/post-pull

cd $DIR
echo "> fetching..." > $LOG
git fetch >> $LOG 2>&1

echo "" >> $LOG
echo "> fetched ... checking for updated" >> $LOG
echo "" >> $LOG
git status | grep behind >> $LOG
stat=$?

echo "" >> $LOG
echo "> updates: $stat" >> $LOG

if [ $stat -eq 0 ] || [ "$1" = "-f" ]
then
        echo "> need to pull..." >> $LOG
        echo "" >> $LOG

        if [ -x "$PRE_PULL" ]
        then
            echo "> running pre-pull script" >> $LOG
            $PRE_PULL >> $LOG 2>&1
        fi

        echo "> pulling..." >> $LOG
        echo "" >> $LOG
        git pull >> $LOG 2>&1
        echo "" >> $LOG
        echo "> pulled..." >> $LOG
        echo "" >> $LOG

        if [ -x "$POST_PULL" ]
        then
            echo "> running post-pull script" >> $LOG
            $POST_PULL >> $LOG 2>&1
        fi

        echo "" >> $LOG
        echo "> everything's done. printing log for mail or something..." >> $LOG
        echo "" >> $LOG

        echo "done" >> $LOG

        cat $LOG
        rm $LOG
else
        rm $LOG
fi



